# 2005-02-27 の作業ログ

## 🎯 今日はどんなことに挑戦する？
- [ ] サービスディレクトリの使用を避けるルールを追加
  - 実装ガイドラインに追加
  - 具体的な代替案を提示
- [ ] `app/services/messages/notification.rb`を適切なディレクトリに移動
  - 新しいディレクトリ構造を検討
  - 参照箇所の更新
- [ ] `Notification`クラスのテストを作成
  - ログ出力のテスト
  - イベント発行のテスト

## 💪 どんなことができた？
- 実装ガイドラインを更新
  - `services`ディレクトリを使わない理由を明確に記載
  - 代替となるディレクトリ構造を提案（commands, queries, presenters など）
  - 各ディレクトリの役割と使用例を記載
- `Notification`クラスを移動
  - `app/services/messages/notification.rb`から`app/messages/notification.rb`へ移動
  - モジュール構造を変更（`Messages::Notification`から`Notification`へ）
  - Zeitwerkの設定を追加して正しくロードされるように調整
- テストコードを作成
  - モックを使用してログ出力をテスト
  - イベントの発行と受信をテスト
  - テストコードのコメントに関するガイドラインを追加

## 💡 新しい発見はあった？
- Zeitwerkのクラスローディングについて
  - モジュール構造とディレクトリ構造の一致が重要
  - `config/initializers/zeitwerk.rb`での設定方法
  - `autoload_paths`の設定方法
- テストでのモックの使い方
  - `double`を使ったモックの作成
  - `expect().to receive()`での期待値設定
  - `.ordered`を使った呼び出し順序の検証
- ログ出力のテスト方法
  - `StringIO`を使ったログのキャプチャ
  - モックを使った簡潔なテスト

## 🎮 次は何をする？
- [ ] イベントディスパッチャーの実装
  - イベントの発行と購読の仕組みを整備
  - テストファーストで進める
- [ ] ハンドラーの実装
  - 各種イベントに対応するハンドラーを実装
  - 責務の分離を意識する

## 🤝 ボブからのエール
### 👍 今日のナイスポイント！
- ディレクトリ構造の改善
  - 責務が明確になるディレクトリ名を採用できた
  - 実装ガイドラインも具体的で分かりやすい
- テストコードの品質
  - モックを効果的に使ってシンプルなテストが書けた
  - テストの意図が明確になるよう工夫できた

### 💭 次に向けてのアドバイス
イベントディスパッチャーの実装では、テストファーストのアプローチを続けるといいですね。また、ハンドラーの実装では、単一責任の原則を意識して、各ハンドラーが一つのことだけを行うように設計するとよいでしょう。

## 🌟 まーさんとのペアプロ振り返り
### 良かったこと
- ディレクトリ構造の議論ができた
  - 責務に基づいたディレクトリ名の重要性
  - 具体的な例を交えた説明
- テストコードの改善
  - モックを使ったシンプルなテスト方法
  - コメントの適切な使い方

### 感じたこと
- ディレクトリ構造が重要
  - 名前が責務を表すことの大切さ
  - 発見可能性が向上する
- テストコードの書き方
  - シンプルで意図が明確なテストの重要性
  - コメントは「なぜ」を説明するために使う
- Zeitwerkの仕組み
  - モジュール構造とディレクトリ構造の一致の重要性
  - 設定方法の理解
  - 特に楽しかったこと
    - モックを使ったテストが思ったより簡単に書けて楽しかった
    - エラーを一つずつ解決していく過程が謎解きのようで面白かった
    - ディレクトリ構造を改善して、コードがより整理されていく感覚が気持ちよかった 