# CQRS Poker

## 1. このプロジェクトの目的

このプロジェクトはゲームを作ることが目的ではない。

### このプロジェクトで何を実現したいのか？

CQRS（Command Query Responsibility Segregation）をシンプルな形で実装することで、その基本的な動作を理解することを目的とする。特に、以下の点に焦点を当てる：

#### イベントソーシングを利用した状態管理
- 状態の変化を直接保存するのではなく、イベントとして記録し、それを基に現在の状態を構築する。

#### コマンドとクエリの分離
- 書き込み（コマンド）と読み取り（クエリ）の責務を明確に分離し、システムの拡張性を確保する。

### このプロジェクトの最も大事な特徴は何か？

このプロジェクトは、CQRS の原則をシンプルな形で適用することに重点を置く。そのため、余計な機能や複雑なビジネスルールは排除し、以下の要素に集中する：

#### 最小限のコマンドとイベント
- StartGame, ExchangeCard, EndGame の3つのコマンドのみを用意し、シンプルな状態変化の流れを表現。

#### シンプルなリードモデルの構築
- EventStore から状態を再構築する仕組みを組み込み、CQRS の「読み取りの独立性」を明示する。

### このプロジェクトがどんな人に役立つのか？

#### 自分が CQRS を理解するため
- 実装を通じて、イベントソーシングや CQRS の基本的な概念を体験的に学ぶ。
- 実際にコードを書きながら、イベントの流れやリードモデルの再構築を確認できる。

#### 他の人に CQRS の考え方を伝えるため
- シンプルなCQRSの例として、他の開発者が学習しやすい構成になっている。
- 余計な機能を削ぎ落とし、CQRSの本質に集中できる設計にすることで、初心者でも理解しやすくする。

## 2. コマンド & イベント設計

### 📖 コマンド一覧

| コマンド名 | 引数 | 説明 |
|------------|------|------|
| StartGame() | なし | ゲームを開始する（イベントの登録のみ） |
| ExchangeCard(oldCard: Card) | oldCard: 交換するカード | 好きなだけ交換できる（1回の実行につき1枚のみ） |
| EndGame() | なし | ゲームを終了する（イベントの登録のみ） |

### 📂 イベント一覧

| イベント名 | event_data のキー | 型 | 説明 |
|------------|------------------|-----|------|
| GameStarted | なし | なし | ゲーム開始時のイベントのみ記録 |
| CardExchanged | oldCard | Card | 交換前のカード（手札内にあることが必須） |
| | newCard | Card | 交換後のカード（デッキの次の1枚） |
| GameEnded | なし | なし | ゲームが終了したことを記録 |

## 3. 実行方法

### 前提条件
- Ruby on Rails がインストールされていること
- 必要な gem がインストール済み (`bundle install` でインストール)

### ゲームの開始
以下のコマンドを実行すると、ゲームが開始されます。

```sh
bin/rake start
```

このコマンドを実行すると、ターミナルにゲームの状態が表示され、ユーザーがコマンドを入力できるようになります。

